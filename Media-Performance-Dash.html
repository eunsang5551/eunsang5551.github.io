<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„±ê³¼ë„ ìˆœìœ„ ë¹„êµ</title>

  <!-- amCharts 4 -->
  <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #chartdiv {
      width: 100%;
      height: 600px;
    }
    h2 {
      text-align: center;
    }
  </style>
</head>
<body>

<h2>ì„±ê³¼ë„ ìˆœìœ„ ë¹„êµ</h2>
<div id="chartdiv"></div>

<script>
am4core.ready(async function () {

  am4core.useTheme(am4themes_animated);

  const chart = am4core.create("chartdiv", am4charts.XYChart);
  chart.padding(40, 40, 40, 40);

  chart.legend = new am4charts.Legend();
  chart.legend.position = "top";

  // ğŸ”¹ CORS í”„ë¡ì‹œ + API
  const API_URL =
    "https://cors-anywhere.herokuapp.com/http://dev-web-api.newssalad.com:8083/document/analysis/press/total";

  try {
    const res = await fetch(API_URL);
    const json = await res.json();

    console.log("API RAW:", json);

    // ğŸ”´ í•µì‹¬ í¬ì¸íŠ¸
    chart.data = json.data;

    console.log("CHART DATA:", chart.data);

  } catch (e) {
    console.error("FETCH ERROR:", e);
  }

  // Y Axis (ì–¸ë¡ ì‚¬)
  const categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
  categoryAxis.dataFields.category = "pressName";
  categoryAxis.renderer.grid.template.location = 0;
  categoryAxis.renderer.inversed = true;

  // X Axis (ìˆ˜ì¹˜)
  const valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
  valueAxis.min = 0;

  // ìµœì´ˆë³´ë„
  const firstSeries = chart.series.push(new am4charts.ColumnSeries());
  firstSeries.dataFields.valueX = "firstCount";
  firstSeries.dataFields.categoryY = "pressName";
  firstSeries.name = "ìµœì´ˆë³´ë„";
  firstSeries.stacked = true;
  firstSeries.columns.template.tooltipText =
    "{name}\n{categoryY}: {valueX}";
  firstSeries.columns.template.width = am4core.percent(80);

  // í›„ì†ë³´ë„
  const followSeries = chart.series.push(new am4charts.ColumnSeries());
  followSeries.dataFields.valueX = "followCount";
  followSeries.dataFields.categoryY = "pressName";
  followSeries.name = "í›„ì†ë³´ë„";
  followSeries.stacked = true;
  followSeries.columns.template.tooltipText =
    "{name}\n{categoryY}: {valueX}";
  followSeries.columns.template.width = am4core.percent(80);

  // ìˆ˜ì¹˜ ë¼ë²¨
  const labelBullet1 = firstSeries.bullets.push(new am4charts.LabelBullet());
  labelBullet1.label.text = "{valueX}";
  labelBullet1.locationX = 0.5;

  const labelBullet2 = followSeries.bullets.push(new am4charts.LabelBullet());
  labelBullet2.label.text = "{valueX}";
  labelBullet2.locationX = 0.5;

});
</script>

</body>
</html>

